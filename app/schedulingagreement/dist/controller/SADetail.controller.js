sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,i,o,a){"use strict";return e.extend("sap.fiori.schedulingagreement.controller.SADetail",{onInit:function(){this.oDataModel=sap.ui.getCore().getModel("oDataModel");this.getView().setModel(this.oDataModel);this.router=sap.ui.core.UIComponent.getRouterFor(this);this.router.attachRouteMatched(this.handleRouteMatched,this);this.detailHeaderModel=new sap.ui.model.json.JSONModel;this.detailHeaderModel.setSizeLimit(1e3);this.getView().setModel(this.detailHeaderModel,"detailHeaderModel");this.detailModel=new sap.ui.model.json.JSONModel;this.detailModel.setSizeLimit(1e3);this.getView().setModel(this.detailModel,"detailModel");this.materialDescModel=new sap.ui.model.json.JSONModel;this.materialDescModel.setSizeLimit(1e3);this.getView().setModel(this.materialDescModel,"materialDescModel");this.ConfirmFragModel=new sap.ui.model.json.JSONModel;this.getView().addStyleClass("sapUiSizeCompact");this.getView().byId("ObjectId").onAfterRendering=function(){sap.m.ObjectHeader.prototype.onAfterRendering.apply(this,arguments);this.$().find(".sapMOHTitleDiv").find(".sapMText").css("color","#af2323")}},handleRouteMatched:function(e){if(e.getParameter("name")==="SADetail"){this.odata={};var i=this;var o=this.getOwnerComponent().getModel();var a=sessionStorage.getItem("unitCode")||"P01";this.AddressCodeSA=sessionStorage.getItem("AddressCodeSA")||"REP-04-04";var s=e.getParameter("arguments").Schedule_No;this.Schedule_No=s.replace(/-/g,"/");var r="/SchedulingAgreements";o.read(r,{urlParameters:{$expand:"DocumentRows",AddressCode:this.AddressCodeSA,UnitCode:a},success:function(e){var t=e.results.find(e=>e.ScheduleNum===i.Schedule_No);if(t){i.detailHeaderModel.setData(t);i.detailHeaderModel.refresh(true);i.detailModel.setData(t.DocumentRows.results);i.detailModel.refresh(true);var o=i.getView().getModel("detailModel").getData();for(var a=0;a<o.length;a++){if(o[a].DeliveredQty==="0"){o[a].ConfirmStatus="Open"}else if(o[a].DeliveredQty===o[a].PoQty){o[a].ConfirmStatus="Closed"}else if(o[a].DeliveredQty>"0"&&o[a].DeliveredQty<o[a].PoQty){o[a].ConfirmStatus="Partially"}}i.detailModel.refresh(true)}else{}},error:function(e){var i=JSON.parse(e.response.body);t.error(i.error.message.value)}})}},onCreateAsn:function(){var e=this;var t=e.Schedule_No.replace(/\//g,"-");e.router.navTo("SAAsnCreate",{Schedule_No:t})},onItempress:function(e){var t=e.getParameter("listItem").getBindingContext("detailModel").getObject();var i=t.SchNum_ScheduleNum;var o=i.replace(/\//g,"-");this.router.navTo("ItemDisplay",{Schedule_No:o,Material_No:t.ItemCode,Line_No:t.LineNum})},onChkBoxSelect:function(e){if(!e.getParameter("selected")){this.checkCount--}else{this.checkCount++}this.getView().byId("chkBoxSelectAll").setSelected(false);if(this.checkCount==this.enabledCount){this.getView().byId("chkBoxSelectAll").setSelected(true)}},selectAllCheck:function(e){var t=this;t.detailModel.refresh(true);var i=e.getParameter("selected");var o=t.detailModel.getData();var a=o.Sitemnav;this.checkCount=0;for(var s=0;s<a.length;s++){if(i){this.isSelected=a[s].Confirm_Status;if(this.isSelected=="Not Confirmed"){a[s].Item_indicator=true;this.checkCount++}}else{a[s].Item_indicator=false}}o.Sitemnav.results=a;this.detailModel.setData(o);this.detailModel.refresh(true)},onCofirmAsn:function(e){var t=this.detailModel.getData();this.router.navTo("SAConfirm",{Schedule_No:t.Schedule_No})},onFragClose:function(e){e.getSource().getParent().close()},onMaterialPress:function(e){var t=e.getSource().getParent().getBindingContext("detailModel").getObject();var o=[];o.push(t);if(!this._oPopoverFragment){this._oPopoverFragment=sap.ui.xmlfragment("sap.fiori.schedulingagreement.fragment.DetailPopoverFragment",this);this.TableTempId=sap.ui.getCore().byId("TableTempId").clone();this.getView().addDependent(this._oPopoverFragment)}this._oPopoverFragment.setModel(new i(o),"materialDescModel");this._oPopoverFragment.openBy(e.getSource())}})});